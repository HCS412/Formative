import{K as z,L,B as S,M as Q,N as B,O as U,P as K,Q as D,R as E,S as k,T as j,U as H,V,W as X,X as Y,Y as Z,Z as N,_ as J,$ as tt,a0 as nt,a1 as R,a2 as et,a3 as at,c as rt,a4 as ot,a5 as it,a6 as st,a7 as O,a8 as G,a9 as ct,aa as ut,u as dt}from"./useChainId-BbZBUEzh.js";import"./index-BWUzC6n8.js";function pt({chain:t,currentChainId:n}){if(!t)throw new z;if(n!==t.id)throw new L({chain:t,currentChainId:n})}class lt extends S{constructor({value:n}){super(`Number \`${n}\` is not a valid decimal number.`,{name:"InvalidDecimalNumberError"})}}function ft(t,n){if(!/^(-?)([0-9]*)\.?([0-9]*)$/.test(t))throw new lt({value:t});let[a,e="0"]=t.split(".");const o=a.startsWith("-");if(o&&(a=a.slice(1)),e=e.replace(/(0+)$/,""),n===0)Math.round(+`.${e}`)===1&&(a=`${BigInt(a)+1n}`),e="";else if(e.length>n){const[r,i,s]=[e.slice(0,n-1),e.slice(n-1,n),e.slice(n)],u=Math.round(+`${i}.${s}`);u>9?e=`${BigInt(r)+BigInt(1)}0`.padStart(r.length+1,"0"):e=`${r}${u}`,e.length>n&&(e=e.slice(1),a=`${BigInt(a)+1n}`),e=e.slice(0,n)}else e=e.padEnd(n,"0");return BigInt(`${o?"-":""}${a}${e}`)}function yt(t,n="wei"){return ft(t,Q[n])}const M=new V(128);async function ht(t,n){const{account:a=t.account,chain:e=t.chain,accessList:o,authorizationList:r,blobs:i,data:s,gas:u,gasPrice:l,maxFeePerBlobGas:c,maxFeePerGas:m,maxPriorityFeePerGas:f,nonce:y,type:d,value:g,...C}=n;if(typeof a>"u")throw new B({docsPath:"/docs/actions/wallet/sendTransaction"});const p=a?D(a):null;try{U(n);const h=await(async()=>{if(n.to)return n.to;if(n.to!==null&&r&&r.length>0)return await K({authorization:r[0]}).catch(()=>{throw new S("`to` is required. Could not infer from `authorizationList`.")})})();if(p?.type==="json-rpc"||p===null){let w;e!==null&&(w=await E(t,k,"getChainId")({}),pt({currentChainId:w,chain:e}));const b=t.chain?.formatters?.transactionRequest?.format,x=(b||j)({...H(C,{format:b}),accessList:o,account:p,authorizationList:r,blobs:i,chainId:w,data:s,gas:u,gasPrice:l,maxFeePerBlobGas:c,maxFeePerGas:m,maxPriorityFeePerGas:f,nonce:y,to:h,type:d,value:g},"sendTransaction"),_=M.get(t.uid),W=_?"wallet_sendTransaction":"eth_sendTransaction";try{return await t.request({method:W,params:[x]},{retryCount:0})}catch(q){if(_===!1)throw q;const T=q;if(T.name==="InvalidInputRpcError"||T.name==="InvalidParamsRpcError"||T.name==="MethodNotFoundRpcError"||T.name==="MethodNotSupportedRpcError")return await t.request({method:"wallet_sendTransaction",params:[x]},{retryCount:0}).then(A=>(M.set(t.uid,!0),A)).catch(A=>{const F=A;throw F.name==="MethodNotFoundRpcError"||F.name==="MethodNotSupportedRpcError"?(M.set(t.uid,!1),T):F});throw T}}if(p?.type==="local"){const w=await E(t,X,"prepareTransactionRequest")({account:p,accessList:o,authorizationList:r,blobs:i,chain:e,data:s,gas:u,gasPrice:l,maxFeePerBlobGas:c,maxFeePerGas:m,maxPriorityFeePerGas:f,nonce:y,nonceManager:p.nonceManager,parameters:[...Y,"sidecars"],type:d,value:g,...C,to:h}),b=e?.serializers?.transaction,$=await p.signTransaction(w,{serializer:b});return await E(t,Z,"sendRawTransaction")({serializedTransaction:$})}throw p?.type==="smart"?new N({metaMessages:["Consider using the `sendUserOperation` Action instead."],docsPath:"/docs/actions/bundler/sendUserOperation",type:"smart"}):new N({docsPath:"/docs/actions/wallet/sendTransaction",type:p?.type})}catch(h){throw h instanceof N?h:J(h,{...n,account:p,chain:n.chain||void 0})}}async function P(t,n){return P.internal(t,ht,"sendTransaction",n)}(function(t){async function n(a,e,o,r){const{abi:i,account:s=a.account,address:u,args:l,dataSuffix:c,functionName:m,...f}=r;if(typeof s>"u")throw new B({docsPath:"/docs/contract/writeContract"});const y=s?D(s):null,d=tt({abi:i,args:l,functionName:m});try{return await E(a,e,o)({data:`${d}${c?c.replace("0x",""):""}`,to:u,account:y,...f})}catch(g){throw nt(g,{abi:i,address:u,args:l,docsPath:"/docs/contract/writeContract",functionName:m,sender:y?.address})}}t.internal=n})(P||(P={}));async function mt(t,n){const{chainId:a,timeout:e=0,...o}=n,r=t.getClient({chainId:a}),s=await R(r,et,"waitForTransactionReceipt")({...o,timeout:e});if(s.status==="reverted"){const u=R(r,at,"getTransaction"),{from:l,...c}=await u({hash:s.transactionHash}),f=await R(r,rt,"call")({...c,account:l,data:c.input,gasPrice:c.type!=="eip1559"?c.gasPrice:void 0,maxFeePerGas:c.type==="eip1559"?c.maxFeePerGas:void 0,maxPriorityFeePerGas:c.type==="eip1559"?c.maxPriorityFeePerGas:void 0}),y=f?.data?ot(`0x${f.data.substring(138)}`):"unknown reason";throw new Error(y)}return{...s,chainId:r.chain.id}}async function wt(t,n){const{account:a,chainId:e,connector:o,...r}=n;let i;return typeof a=="object"&&a?.type==="local"?i=t.getClient({chainId:e}):i=await it(t,{account:a??void 0,assertChainId:!1,chainId:e,connector:o}),await R(i,P,"writeContract")({...r,...a?{account:a}:{},chain:e?{id:e}:null})}function gt(t,n={}){return{async queryFn({queryKey:a}){const{hash:e,...o}=a[1];if(!e)throw new Error("hash is required");return mt(t,{...o,onReplaced:n.onReplaced,hash:e})},queryKey:Tt(n)}}function Tt(t={}){const{onReplaced:n,...a}=t;return["waitForTransactionReceipt",st(a)]}function Ct(t){return{mutationFn(n){return wt(t,n)},mutationKey:["writeContract"]}}function bt(t={}){const{hash:n,query:a={}}=t,e=O(t),o=G({config:e}),r=gt(e,{...t,chainId:t.chainId??o}),i=!!(n&&(a.enabled??!0));return ct({...a,...r,enabled:i})}function It(t={}){const{mutation:n}=t,a=O(t),e=Ct(a),{mutate:o,mutateAsync:r,...i}=ut({...n,...e});return{...i,writeContract:o,writeContractAsync:r}}const I=[{inputs:[{internalType:"address",name:"_influencer",type:"address"},{internalType:"uint256",name:"_deadline",type:"uint256"},{internalType:"string",name:"_platformCampaignId",type:"string"}],name:"createCampaign",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"_campaignId",type:"uint256"}],name:"approveAndRelease",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_campaignId",type:"uint256"}],name:"cancelCampaign",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"_campaignId",type:"uint256"}],name:"claimAfterDeadline",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"campaigns",outputs:[{internalType:"address",name:"brand",type:"address"},{internalType:"address",name:"influencer",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"uint256",name:"platformFee",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"bool",name:"approved",type:"bool"},{internalType:"bool",name:"released",type:"bool"},{internalType:"bool",name:"cancelled",type:"bool"},{internalType:"string",name:"campaignId",type:"string"}],stateMutability:"view",type:"function"},{inputs:[],name:"campaignCount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"}],v={11155111:"0x0000000000000000000000000000000000000000",1:"0x0000000000000000000000000000000000000000",8453:"0x0000000000000000000000000000000000000000"};function Et(t){return v[t]||v[11155111]}function At(){const{address:t,isConnected:n}=dt(),a=G(),e=Et(a),{writeContract:o,data:r,isPending:i,error:s}=It(),{isLoading:u,isSuccess:l}=bt({hash:r});return{createEscrowCampaign:async(d,g,C,p)=>{if(!n||!t)throw new Error("Please connect your wallet");if(e==="0x0000000000000000000000000000000000000000")throw new Error("Contract not deployed on this network. Please switch networks or contact support.");const h=Math.floor(new Date(g).getTime()/1e3),w=yt(p.toString());return o({address:e,abi:I,functionName:"createCampaign",args:[d,BigInt(h),C],value:w})},approveAndRelease:async d=>{if(!n)throw new Error("Please connect your wallet");return o({address:e,abi:I,functionName:"approveAndRelease",args:[BigInt(d)]})},cancelCampaign:async d=>{if(!n)throw new Error("Please connect your wallet");return o({address:e,abi:I,functionName:"cancelCampaign",args:[BigInt(d)]})},claimAfterDeadline:async d=>{if(!n)throw new Error("Please connect your wallet");return o({address:e,abi:I,functionName:"claimAfterDeadline",args:[BigInt(d)]})},isPending:i||u,isSuccess:l,error:s,hash:r,isConnected:n,address:t,contractAddress:e}}export{At as useCampaignEscrow};
